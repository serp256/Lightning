OCAMLFIND = ocamlfind -toolchain android
OCAMLOPT = $(OCAMLFIND) ocamlopt
OCAMLC = $(OCAMLFIND) ocamlc
include Makefile.common
include Makefile.in

-include target

TARGET ?= example

res:	
	aresmkr -concat -i Resources -o android/assets/assets
	aresmkr -merge -o android/assets/index android/assets/assets
	#rm android/assets/assets.index

so: $(TARGET).so res
	cp test.so android/libs/armeabi-v7a/libtest.so
	ant -f android/build.xml debug

release: $(TARGET).so
	cp test.so android/libs/armeabi-v7a/libtest.so
	ant -f android/build.xml release

$(TARGET).so: $(MLXFILES) $(TARGET).cmx
	$(OCAMLOPT) -verbose -o test.so  -g  \
	-I ../src ../src/lightning.cmxa  $(OAUTHX) $(SOCIALX) $(MLXFILES) ../src/plugins/facebook/facebook.cmxa ../src/plugins/flurry/flurry.cmxa ../src/plugins/chartboost/chartboost.cmxa ../src/plugins/mobileapptracking/mobileapptracking.cmxa ../src/plugins/tapjoy/tapjoy.cmxa $(TARGET).cmx \
	-package extlib,xmlm,ojson,bigarray,redspell.debug -linkpkg -cclib "-L../src/android/libpng" -cclib "-L../src/android/libjpeg" -cclib "-L../src/android/libcurl" -cclib "-L../src/plugins/facebook" -cclib "-L../src/plugins/mopub" -cclib "-L../src/plugins/mobileapptracking"  ../src/plugins/mobileapptracking/mobileapptracking.cmxa  -cclib "-L../src/plugins/tapjoy" -cclib "-L../src/plugins/chartboost" -cclib "-L../src/plugins/flurry"  -output-obj

clean::
	rm -f LightTest/*.o LighTest/*.so 


.DEFAULT_GOAL = so
